[[inputs.exec]]
  name_override = "ACI_NodeHealth"
  commands = ["sh /etc/telegraf/apic_query.sh sandboxapicdc.cisco.com /api/class/fabricNodeHealth5min.json telegraf telegraf"]
  timeout = "10s"
  data_format = "json"

  json_query = "imdata"
  tag_keys = ["fabricNodeHealth5min_attributes_dn"]
  json_string_fields = ["*healthLast"]

  [inputs.exec.tags]
     apic = "sandboxapicdc.cisco.com"

[[processors.converter]]
  namepass = ["ACI_NodeHealth"]

  [processors.converter.fields]
    integer = ["fabricNodeHealth5min_attributes_healthLast"]

[[processors.regex]]
  namepass = ["ACI_NodeHealth"]

  [[processors.regex.tags]]
    key = "fabricNodeHealth5min_attributes_dn"
    pattern = "topology/"
    replacement = ""
  [[processors.regex.tags]]
    key = "fabricNodeHealth5min_attributes_dn"
    pattern = "/sys/CDfabricNodeHealth5min"
    replacement = ""
